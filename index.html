<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Meta tag para garantir que o dom√≠nio seja enviado corretamente para o Google validar a seguran√ßa -->
    <meta name="referrer" content="origin">
    <title>Padaria Giovaninni Delivery</title>
    
    <!-- 1. ESTILOS (Tailwind CSS) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slide-in-right {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        .animate-slide-in-right { animation: slide-in-right 0.3s ease-out; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        html { scroll-behavior: smooth; }
    </style>

    <!-- 2. REACT (O Motor do App) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 3. BABEL (Tradutor de C√≥digo) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. FIREBASE (Banco de Dados) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-50 text-gray-900">
    <div id="root"></div>

    <script type="text/babel">
        // ==================================================================================
        // ‚ö†Ô∏è NOTA DE SEGURAN√áA: 
        // √â normal esta chave estar vis√≠vel. A seguran√ßa √© feita restringindo o DOM√çNIO
        // no Google Cloud Console (APIs & Services > Credentials > Restrict to HTTP Referrers).
        // ==================================================================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyCla2aKwqrq2cjrbFGdBD9S1phO9H2MlHY",
            authDomain: "base-de-dados-pad-giovaninni.firebaseapp.com",
            databaseURL: "https://base-de-dados-pad-giovaninni-default-rtdb.firebaseio.com",
            projectId: "base-de-dados-pad-giovaninni",
            storageBucket: "base-de-dados-pad-giovaninni.firebasestorage.app",
            messagingSenderId: "355742663610",
            appId: "1:355742663610:web:091aed90ebf7b8d0ded383"
        };

        // ==================================================================================
        // INICIALIZA√á√ÉO GLOBAL DO FIREBASE
        // ==================================================================================
        
        let app, auth, db;
        
        const isConfigured = firebaseConfig.apiKey !== "SUA_API_KEY_AQUI" && firebaseConfig.projectId !== "SEU_PROJETO_ID";

        if (isConfigured) {
            try {
                if (!firebase.apps.length) {
                    app = firebase.initializeApp(firebaseConfig);
                } else {
                    app = firebase.app();
                }
                auth = firebase.auth();
                db = firebase.firestore();
                console.log("Firebase conectado com sucesso!");
                
                auth.onAuthStateChanged((user) => {
                    if (!user) {
                        auth.signInAnonymously().catch((error) => console.error("Erro auth an√¥nimo:", error));
                    }
                });
                
            } catch (e) {
                console.error("Erro ao iniciar Firebase:", e);
            }
        }

        const { useState, useEffect } = React;

        // --- √çCONES ---
        const Icons = {
            ShoppingBag: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            Minus: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/></svg>,
            ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            Star: () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
            Lock: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            Truck: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11"/><path d="M14 9h4l4 4v4c0 .6-.4 1-1 1h-2"/><circle cx="7" cy="18" r="2"/><circle cx="17" cy="18" r="2"/></svg>,
            LogOut: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>,
            DollarSign: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
            Edit2: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,
            Trash2: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            Save: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>,
            LayoutDashboard: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>,
            Coffee: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="1" y2="4"/><line x1="10" x2="10" y1="1" y2="4"/><line x1="14" x2="14" y1="1" y2="4"/></svg>,
            ClipboardList: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>,
            Download: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Loader: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
            Eye: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>,
            EyeOff: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/><line x1="2" x2="22" y1="2" y2="22"/></svg>,
            List: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>,
            Instagram: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/></svg>,
            Image: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>
        };

        const DEFAULT_CATEGORIES = ['Combos Estrat√©gicos', 'P√£es', 'Lanches', 'Doces de V√≥', 'Bebidas', 'Outros'];
        const ORDER_STATUS = {
            pending: { label: 'Pendente', color: 'bg-yellow-100 text-yellow-800' },
            preparing: { label: 'Preparando', color: 'bg-blue-100 text-blue-800' },
            delivering: { label: 'Saiu p/ Entrega', color: 'bg-orange-100 text-orange-800' },
            completed: { label: 'Entregue', color: 'bg-green-100 text-green-800' },
            cancelled: { label: 'Cancelado', color: 'bg-red-100 text-red-800' }
        };

        // --- TELA DE AJUDA ---
        const ConfigHelp = () => (
            <div className="min-h-screen flex items-center justify-center bg-gray-900 text-white p-4">
                <div className="max-w-2xl w-full bg-gray-800 p-8 rounded-2xl shadow-2xl border border-gray-700">
                    <h1 className="text-3xl font-bold text-orange-500 mb-4 flex items-center gap-2">Configura√ß√£o Necess√°ria</h1>
                    <p className="text-gray-300 mb-6 text-lg">As chaves do Firebase parecem incorretas.</p>
                </div>
            </div>
        );

        // --- COMPONENTES ---

        const ProductCard = ({ product, onAdd, quantity }) => (
            <div className={`bg-white rounded-xl shadow-sm border border-orange-100 overflow-hidden flex flex-col hover:shadow-md transition-all ${!product.available ? 'opacity-60 grayscale' : ''}`}>
                <div className="relative h-48 overflow-hidden bg-gray-200">
                    <img src={product.image} alt={product.name} className="w-full h-full object-cover" onError={(e) => e.target.src='https://via.placeholder.com/400x300?text=Sem+Foto'} />
                    {product.popular && product.available && (
                        <span className="absolute top-2 right-2 bg-orange-500 text-white text-xs font-bold px-2 py-1 rounded-full flex items-center shadow-sm">
                            <Icons.Star /> <span className="ml-1">Mais Pedido</span>
                        </span>
                    )}
                    {!product.available && (
                        <div className="absolute inset-0 bg-black/40 flex items-center justify-center">
                            <span className="bg-red-600 text-white font-bold px-3 py-1 rounded-full text-sm">ESGOTADO</span>
                        </div>
                    )}
                </div>
                <div className="p-4 flex-1 flex flex-col">
                    <h3 className="font-bold text-gray-800 text-lg leading-tight mb-2">{product.name}</h3>
                    <p className="text-gray-500 text-sm mb-4 line-clamp-2 flex-1">{product.description}</p>
                    <div className="flex items-center justify-between mt-auto">
                        <span className="font-bold text-xl text-orange-900">R$ {parseFloat(product.price || 0).toFixed(2).replace('.', ',')}</span>
                        {product.available ? (
                            quantity > 0 ? (
                                <div className="flex items-center bg-orange-50 rounded-lg border border-orange-200">
                                    <button onClick={() => onAdd(product, -1)} className="p-2 text-orange-600 hover:bg-orange-100 rounded-l-lg"><Icons.Minus /></button>
                                    <span className="px-2 font-semibold text-orange-900 w-6 text-center">{quantity}</span>
                                    <button onClick={() => onAdd(product, 1)} className="p-2 text-orange-600 hover:bg-orange-100 rounded-r-lg"><Icons.Plus /></button>
                                </div>
                            ) : (
                                <button onClick={() => onAdd(product, 1)} className="bg-orange-600 text-white px-4 py-2 rounded-lg font-medium text-sm hover:bg-orange-700 transition-colors shadow-sm">Adicionar</button>
                            )
                        ) : (
                            <span className="text-xs font-bold text-gray-400">Indispon√≠vel</span>
                        )}
                    </div>
                </div>
            </div>
        );

        const CartDrawer = ({ isOpen, onClose, cart, products, onUpdateCart }) => {
            const [customerName, setCustomerName] = useState('');
            const [phone, setPhone] = useState('');
            const [keyword, setKeyword] = useState('');
            const [address, setAddress] = useState('');
            const [paymentMethod, setPaymentMethod] = useState('pix');
            const [notes, setNotes] = useState('');
            const [isSubmitting, setIsSubmitting] = useState(false);

            const cartItems = Object.entries(cart).map(([id, quantity]) => {
                const product = products.find(p => p.id === id);
                return product ? { ...product, quantity } : null;
            }).filter(item => item && item.quantity > 0);

            const subtotal = cartItems.reduce((acc, item) => acc + (item.price * item.quantity), 0);
            const totalCost = cartItems.reduce((acc, item) => acc + ((item.costPrice || 0) * item.quantity), 0);
            const deliveryFee = subtotal >= 60 ? 0 : 8.00;
            const total = subtotal + deliveryFee;

            const handleCheckout = async () => {
                if (!customerName || !address || !phone || !keyword) { alert('Por favor, preencha todos os campos obrigat√≥rios (*).'); return; }
                setIsSubmitting(true);
                try {
                    const orderData = {
                        customerName, phone: phone.replace(/\D/g, ''), keyword: keyword.trim().toLowerCase(), address, paymentMethod, notes,
                        items: cartItems.map(i => ({ name: i.name, quantity: i.quantity, price: i.price, costPrice: i.costPrice || 0 })),
                        subtotal, deliveryFee, total, totalCost, status: 'pending', createdAt: new Date().toISOString()
                    };
                    await db.collection('orders').add(orderData);
                    let message = `*NOVO PEDIDO - PADARIA GIOVANINNI* ü•ñ\n-----------------------------\n*Cliente:* ${customerName}\n*Fone:* ${phone}\n*Rastreio:* ${keyword}\n*Endere√ßo:* ${address}\n*Pagto:* ${paymentMethod.toUpperCase()}\n\n*--- ITENS ---*\n`;
                    cartItems.forEach(item => { message += `${item.quantity}x ${item.name} \n(R$ ${(item.price * item.quantity).toFixed(2)})\n`; });
                    if(notes) message += `\n*Obs:* ${notes}\n`;
                    message += `\n*Entrega:* ${deliveryFee === 0 ? 'GR√ÅTIS' : `R$ ${deliveryFee.toFixed(2)}`}\n*TOTAL: R$ ${total.toFixed(2)}*\n-----------------------------\n_Pedido registrado._`;
                    // N√∫mero do WhatsApp atualizado (55 + DDD + N√∫mero)
                    window.open(`https://wa.me/5531987133022?text=${encodeURIComponent(message)}`, '_blank');
                    onClose(); alert("Pedido enviado!");
                } catch (error) { alert("Erro ao registrar."); } finally { setIsSubmitting(false); }
            };

            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex justify-end">
                    <div className="absolute inset-0 bg-black/50 backdrop-blur-sm" onClick={onClose}></div>
                    <div className="relative w-full max-w-md bg-white h-full shadow-2xl flex flex-col animate-slide-in-right">
                        <div className="p-4 bg-orange-600 text-white flex justify-between items-center shadow-md"><h2 className="font-bold text-xl flex items-center gap-2"><Icons.ShoppingBag /> Seu Pedido</h2><button onClick={onClose}><Icons.X /></button></div>
                        <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
                            {cartItems.length === 0 ? <p className="text-center text-gray-400 py-10">Sua sacola est√° vazia.</p> : cartItems.map(item => (
                                <div key={item.id} className="flex gap-3 bg-white p-3 rounded-lg border border-gray-100 shadow-sm">
                                    <div className="flex-1"><h4 className="font-bold text-gray-800 text-sm">{item.name}</h4><p className="text-orange-600 font-bold text-sm">R$ {item.price.toFixed(2)}</p></div>
                                    <div className="flex items-center gap-2 bg-gray-100 rounded-lg p-1 h-8">
                                        <button onClick={() => onUpdateCart(item, -1)} className="px-2"><Icons.Minus /></button><span className="text-xs font-bold">{item.quantity}</span><button onClick={() => onUpdateCart(item, 1)} className="px-2"><Icons.Plus /></button>
                                    </div>
                                </div>
                            ))}
                        </div>
                        {cartItems.length > 0 && (
                            <div className="p-4 bg-white border-t border-gray-200">
                                <div className="bg-orange-50 p-3 rounded-lg mb-4 border border-orange-100">
                                    <p className="text-xs font-bold text-orange-800 uppercase mb-2">Dados Obrigat√≥rios</p>
                                    <input type="text" placeholder="Seu Nome*" className="w-full p-2 mb-2 text-sm border rounded" value={customerName} onChange={(e) => setCustomerName(e.target.value)} />
                                    <input type="tel" placeholder="Seu Celular (Ex: 11999998888)*" className="w-full p-2 mb-2 text-sm border rounded" value={phone} onChange={(e) => setPhone(e.target.value)} />
                                    <input type="text" placeholder="Crie uma Palavra-chave (Rastreio)*" className="w-full p-2 mb-2 text-sm border rounded" value={keyword} onChange={(e) => setKeyword(e.target.value)} />
                                    <input type="text" placeholder="Endere√ßo Completo*" className="w-full p-2 text-sm border rounded" value={address} onChange={(e) => setAddress(e.target.value)} />
                                </div>
                                <select className="w-full p-2 mb-2 text-sm border rounded bg-white" value={paymentMethod} onChange={(e) => setPaymentMethod(e.target.value)}><option value="pix">Pagamento via PIX</option><option value="cartao">Cart√£o</option><option value="dinheiro">Dinheiro</option></select>
                                <div className="flex justify-between font-bold text-lg text-gray-900 pt-2 mb-4 border-t border-dashed"><span>Total</span><span>R$ {total.toFixed(2)}</span></div>
                                <button onClick={handleCheckout} disabled={isSubmitting} className="w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 disabled:bg-gray-400 flex justify-center items-center gap-2">{isSubmitting ? "Enviando..." : "Finalizar Pedido"}</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const OrderTracker = ({ onClose }) => {
            const [phone, setPhone] = useState('');
            const [keyword, setKeyword] = useState('');
            const [result, setResult] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleSearch = async (e) => {
                e.preventDefault(); setLoading(true); setError(''); setResult(null);
                try {
                    const snapshot = await db.collection('orders').where('phone', '==', phone.replace(/\D/g, '')).where('keyword', '==', keyword.trim().toLowerCase()).get();
                    if (!snapshot.empty) { const orders = snapshot.docs.map(doc => doc.data()).sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt)); setResult(orders[0]); } else { setError('Pedido n√£o encontrado.'); }
                } catch (err) { setError('Erro na busca.'); } finally { setLoading(false); }
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden p-6 relative">
                        <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><Icons.X /></button>
                        <h2 className="font-bold text-lg mb-4 flex items-center gap-2 text-orange-600"><Icons.Truck /> Rastrear Pedido</h2>
                        {!result ? (
                            <form onSubmit={handleSearch} className="space-y-4">
                                <input type="tel" className="w-full border p-3 rounded-lg" placeholder="Seu Celular (S√≥ n√∫meros)" value={phone} onChange={e => setPhone(e.target.value)} required />
                                <input type="text" className="w-full border p-3 rounded-lg" placeholder="Sua Palavra-chave" value={keyword} onChange={e => setKeyword(e.target.value)} required />
                                {error && <p className="text-red-500 text-sm text-center">{error}</p>}
                                <button type="submit" disabled={loading} className="w-full bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700">{loading ? 'Buscando...' : 'Buscar'}</button>
                            </form>
                        ) : (
                            <div className="text-center space-y-4">
                                <h3 className="font-bold text-xl text-green-600">Pedido Encontrado!</h3>
                                <div className="bg-gray-50 p-4 rounded-xl text-left border border-gray-100">
                                    <div className="flex justify-between mb-2"><span className="text-gray-500 text-sm">Status:</span><span className={`px-2 py-0.5 rounded text-xs font-bold uppercase ${ORDER_STATUS[result.status]?.color}`}>{ORDER_STATUS[result.status]?.label}</span></div>
                                    <div className="flex justify-between border-t pt-2 mt-2"><span className="font-bold">Total:</span><span className="font-bold text-orange-600">R$ {result.total.toFixed(2)}</span></div>
                                </div>
                                <div className="text-xs text-gray-400">{result.items.map(i => `${i.quantity}x ${i.name}`).join(', ')}</div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const AdminPanel = ({ products, onLogout, role, categories, onSaveCategories }) => {
            const [activeTab, setActiveTab] = useState('orders');
            const [orders, setOrders] = useState([]);
            const [formData, setFormData] = useState({});
            const [editingId, setEditingId] = useState(null);
            const [creating, setCreating] = useState(false);
            const [finFilter, setFinFilter] = useState('all');
            
            // Estado para Edi√ß√£o de Categorias
            const [tempCats, setTempCats] = useState(categories);
            const [newCat, setNewCat] = useState('');

            // LISTA DE EXEMPLOS PARA POPULAR O FORMUL√ÅRIO DE CRIA√á√ÉO
            const EXAMPLE_PRODUCTS = [
                { name: 'P√£o Franc√™s Crocante', category: 'P√£es', image: 'https://images.unsplash.com/photo-1598373182133-52452f7691ef?auto=format&fit=crop&w=800&q=80' },
                { name: 'Bolo de Cenoura com Chocolate', category: 'Doces de V√≥', image: 'https://images.unsplash.com/photo-1578985545062-69928b1d9587?auto=format&fit=crop&w=800&q=80' },
                { name: 'Croissant Amanteigado', category: 'Lanches', image: 'https://images.unsplash.com/photo-1555507036-ab1f4038808a?auto=format&fit=crop&w=800&q=80' },
                { name: 'Caf√© Expresso', category: 'Bebidas', image: 'https://images.unsplash.com/photo-1509042239860-f550ce710b93?auto=format&fit=crop&w=800&q=80' },
                { name: 'Sonho de Creme', category: 'Doces de V√≥', image: 'https://images.unsplash.com/photo-1576618148400-f54bed99fcf8?auto=format&fit=crop&w=800&q=80' }
            ];

            useEffect(() => {
                if (!db) return;
                const unsubscribe = db.collection('orders').orderBy('createdAt', 'desc').onSnapshot(snap => { setOrders(snap.docs.map(doc => ({id: doc.id, ...doc.data()}))); });
                return () => unsubscribe();
            }, []);

            useEffect(() => { setTempCats(categories); }, [categories]);

            const handleSave = async () => {
                if(!editingId) return;
                const { id, ...data } = formData;
                if (data.price === '' || isNaN(data.price)) data.price = 0;
                if (data.costPrice === '' || isNaN(data.costPrice)) data.costPrice = 0;
                try { await db.collection('products').doc(editingId).update(data); setEditingId(null); } catch (e) { alert("Erro ao salvar: " + e.message); }
            };

            const handleCreate = async () => {
                setCreating(true);
                try {
                    // SORTEAR UM EXEMPLO
                    const randomExample = EXAMPLE_PRODUCTS[Math.floor(Math.random() * EXAMPLE_PRODUCTS.length)];
                    
                    await db.collection('products').add({
                        name: randomExample.name, 
                        description: 'Descri√ß√£o deliciosa do produto...', 
                        price: 0, 
                        costPrice: 0, 
                        category: categories.includes(randomExample.category) ? randomExample.category : (categories[0] || 'Outros'), 
                        image: randomExample.image, 
                        available: true, 
                        hidden: false, 
                        popular: false, 
                        createdAt: new Date().toISOString()
                    });
                    setTimeout(() => { window.scrollTo({ top: 0, behavior: 'smooth' }); alert("Produto criado no topo!"); }, 500);
                } catch (error) { alert("Erro ao criar."); } finally { setCreating(false); }
            };

            const handleDelete = async (id) => { if (window.confirm("Remover permanentemente?")) { try { await db.collection('products').doc(id).delete(); } catch (error) { alert("Erro: " + error.message); } } };
            const toggleAvail = async (p) => await db.collection('products').doc(p.id).update({available: !p.available});
            const toggleHidden = async (p) => await db.collection('products').doc(p.id).update({hidden: !p.hidden});
            const updateStatus = async (id, s) => await db.collection('orders').doc(id).update({status: s});
            
            const handleCategorySave = async () => {
                try { onSaveCategories(tempCats); alert("Categorias salvas!"); } catch(e) { alert("Erro ao salvar categorias."); }
            };
            const addCat = () => { if(newCat.trim()) { setTempCats([...tempCats, newCat.trim()]); setNewCat(''); }};
            const removeCat = (idx) => { setTempCats(tempCats.filter((_, i) => i !== idx)); };
            const updateCat = (idx, val) => { const c = [...tempCats]; c[idx] = val; setTempCats(c); };

            // AUTO-FIX: Corrige categorias antigas ao editar
            const startEditing = (p) => {
                let correctedProduct = { ...p };
                if (correctedProduct.category === 'P√£es Artesanais') {
                    correctedProduct.category = 'P√£es';
                }
                setFormData(correctedProduct);
                setEditingId(p.id);
            };

            const filteredOrders = orders.filter(o => {
                if (o.status === 'cancelled') return false;
                const d = new Date(o.createdAt); const now = new Date(); const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                if (finFilter === 'today') return d >= today;
                if (finFilter === 'week') { const w = new Date(today); w.setDate(today.getDate()-7); return d >= w; }
                if (finFilter === 'month') return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
                return true;
            });
            const gross = filteredOrders.reduce((acc,o) => acc + (o.total||0), 0);
            const cost = filteredOrders.reduce((acc,o) => acc + (o.totalCost||0), 0);
            const profit = gross - cost;

            const exportCSV = () => {
                const headers = "Data,Cliente,Total,Lucro,Status\n";
                const rows = filteredOrders.map(o => `${new Date(o.createdAt).toLocaleDateString()},${o.customerName},${o.total},${(o.total||0)-(o.totalCost||0)},${o.status}`).join("\n");
                const blob = new Blob([headers + rows], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a"); link.href = URL.createObjectURL(blob); link.download = "relatorio.csv"; link.click();
            };

            const sortedProducts = [...products].sort((a,b) => { if (a.createdAt && b.createdAt) return new Date(b.createdAt) - new Date(a.createdAt); return a.name.localeCompare(b.name); });

            return (
                <div className="min-h-screen bg-gray-100 pb-20">
                    <header className="bg-gray-900 text-white p-4 sticky top-0 z-10 flex justify-between items-center shadow-lg">
                        <div className="flex items-center gap-2"><Icons.LayoutDashboard /><h1 className="font-bold">Gest√£o ({role === 'owner' ? 'Dono' : 'Func'})</h1></div>
                        <button onClick={onLogout} className="flex items-center gap-2 text-sm bg-gray-800 px-3 py-1.5 rounded"><Icons.LogOut size={16}/> Sair</button>
                    </header>
                    <div className="container mx-auto p-4">
                        <div className="flex gap-2 mb-6 overflow-x-auto">
                            <button onClick={()=>setActiveTab('orders')} className={`px-4 py-2 rounded font-bold text-sm ${activeTab==='orders'?'bg-orange-600 text-white':'bg-white'}`}>Pedidos</button>
                            <button onClick={()=>setActiveTab('menu')} className={`px-4 py-2 rounded font-bold text-sm ${activeTab==='menu'?'bg-orange-600 text-white':'bg-white'}`}>Card√°pio</button>
                            <button onClick={()=>setActiveTab('categories')} className={`px-4 py-2 rounded font-bold text-sm ${activeTab==='categories'?'bg-orange-600 text-white':'bg-white'}`}>Categorias</button>
                            {role==='owner' && <button onClick={()=>setActiveTab('financial')} className={`px-4 py-2 rounded font-bold text-sm ${activeTab==='financial'?'bg-orange-600 text-white':'bg-white'}`}>Financeiro</button>}
                        </div>

                        {activeTab === 'categories' && (
                            <div className="bg-white p-6 rounded-xl shadow">
                                <h3 className="font-bold text-lg mb-4">Gerenciar Categorias</h3>
                                <div className="flex gap-2 mb-4">
                                    <input value={newCat} onChange={e=>setNewCat(e.target.value)} placeholder="Nova Categoria" className="border p-2 rounded flex-1"/>
                                    <button onClick={addCat} className="bg-green-600 text-white px-4 py-2 rounded font-bold"><Icons.Plus/></button>
                                </div>
                                <div className="space-y-2">
                                    {tempCats.map((c, idx) => (
                                        <div key={idx} className="flex gap-2 items-center">
                                            <input value={c} onChange={e=>updateCat(idx, e.target.value)} className="border p-2 rounded w-full"/>
                                            <button onClick={()=>removeCat(idx)} className="text-red-500 hover:bg-red-50 p-2 rounded"><Icons.Trash2/></button>
                                        </div>
                                    ))}
                                </div>
                                <button onClick={handleCategorySave} className="mt-6 w-full bg-orange-600 text-white py-3 rounded-lg font-bold hover:bg-orange-700">Salvar Altera√ß√µes</button>
                            </div>
                        )}

                        {activeTab === 'financial' && role === 'owner' && (
                            <div>
                                <div className="bg-white p-4 rounded-xl shadow mb-4 flex flex-wrap gap-2 justify-between">
                                    <div className="flex gap-2">
                                        {['today','week','month','all'].map(f => <button key={f} onClick={()=>setFinFilter(f)} className={`px-3 py-1 rounded text-xs font-bold uppercase ${finFilter===f?'bg-blue-600 text-white':'bg-gray-100'}`}>{f==='today'?'Hoje':f==='week'?'Semana':f==='month'?'M√™s':'Tudo'}</button>)}
                                    </div>
                                    <button onClick={exportCSV} className="bg-green-600 text-white px-3 py-1 rounded text-xs font-bold flex gap-1"><Icons.Download size={14}/> CSV</button>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <div className="bg-white p-4 rounded-xl border-l-4 border-blue-500 shadow"><p className="text-xs font-bold text-gray-500 uppercase">Faturamento</p><p className="text-2xl font-bold">R$ {gross.toFixed(2)}</p></div>
                                    <div className="bg-white p-4 rounded-xl border-l-4 border-red-500 shadow"><p className="text-xs font-bold text-gray-500 uppercase">Custos</p><p className="text-2xl font-bold">R$ {cost.toFixed(2)}</p></div>
                                    <div className="bg-white p-4 rounded-xl border-l-4 border-green-500 shadow"><p className="text-xs font-bold text-gray-500 uppercase">Lucro</p><p className="text-2xl font-bold text-green-600">R$ {profit.toFixed(2)}</p></div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'orders' && (
                            <div className="space-y-4">
                                {orders.map(order => (
                                    <div key={order.id} className="bg-white rounded-lg shadow border border-gray-200 p-4">
                                        <div className="flex justify-between items-start mb-2"><div><span className="font-bold">#{order.id.slice(0,4)}</span> <span className="text-gray-500">{order.customerName}</span></div><select className={`text-xs border rounded p-1 font-bold ${ORDER_STATUS[order.status]?.color}`} value={order.status} onChange={(e)=>updateStatus(order.id, e.target.value)}>{Object.entries(ORDER_STATUS).map(([k,v]) => <option key={k} value={k}>{v.label}</option>)}</select></div>
                                        <div className="text-sm text-gray-600 mb-2">{order.items.map(i => `${i.quantity}x ${i.name}`).join(', ')}</div>
                                        <div className="flex justify-between text-xs text-gray-500"><span>{new Date(order.createdAt).toLocaleString()}</span><span className="font-bold text-gray-800 text-sm">R$ {order.total.toFixed(2)}</span></div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'menu' && (
                            <div className="bg-white rounded-xl shadow overflow-hidden">
                                <div className="p-4 bg-gray-50 border-b flex justify-between items-center"><h3 className="font-bold">Produtos</h3><button onClick={handleCreate} disabled={creating} className="bg-orange-600 text-white px-3 py-1 rounded text-sm font-bold flex items-center gap-1 hover:bg-orange-700 disabled:bg-gray-400">{creating ? <Icons.Loader /> : <Icons.Plus />} {creating ? 'A criar...' : 'Adicionar'}</button></div>
                                {sortedProducts.map(p => (
                                    <div key={p.id} className="p-4 border-b flex justify-between items-center hover:bg-gray-50">
                                        {editingId === p.id ? (
                                            <div className="w-full space-y-2 bg-gray-50 p-2 rounded border border-orange-200">
                                                <input className="border p-1 w-full text-sm" placeholder="Nome" value={formData.name} onChange={e=>setFormData({...formData, name:e.target.value})}/>
                                                <textarea className="border p-1 w-full text-sm" placeholder="Descri√ß√£o" rows="2" value={formData.description} onChange={e=>setFormData({...formData, description:e.target.value})}/>
                                                <div className="flex gap-2">
                                                    <input className="border p-1 w-full text-sm text-gray-500" placeholder="URL da Imagem" value={formData.image} onChange={e=>setFormData({...formData, image:e.target.value})}/>
                                                    <button onClick={() => setFormData({...formData, image: EXAMPLE_PRODUCTS[Math.floor(Math.random() * EXAMPLE_PRODUCTS.length)].image})} className="bg-purple-100 text-purple-600 p-2 rounded hover:bg-purple-200" title="Usar imagem de exemplo"><Icons.Image/></button>
                                                </div>
                                                <div className="flex gap-2 items-center">
                                                    <div className="flex-1">
                                                        <label className="text-xs text-gray-500">Categoria</label>
                                                        <select className="border p-1 w-full text-sm" value={formData.category} onChange={e=>setFormData({...formData, category:e.target.value})}>
                                                            {categories.map(c => <option key={c} value={c}>{c}</option>)}
                                                        </select>
                                                    </div>
                                                    <div className="w-24"><label className="text-xs text-gray-500">Pre√ßo</label><input className={`border p-1 w-full text-sm ${role !== 'owner' ? 'bg-gray-200 cursor-not-allowed' : ''}`} type="number" step="0.1" disabled={role !== 'owner'} value={formData.price===undefined||formData.price===null?'':formData.price} onChange={e=>{const val=e.target.value===''?'':parseFloat(e.target.value);setFormData({...formData, price:val});}}/></div>
                                                    {role==='owner'&&<div className="w-24"><label className="text-xs text-gray-500">Custo</label><input className="border p-1 w-full text-sm bg-red-50" type="number" step="0.1" value={formData.costPrice===undefined||formData.costPrice===null?'':formData.costPrice} onChange={e=>{const val=e.target.value===''?'':parseFloat(e.target.value);setFormData({...formData, costPrice:val});}}/></div>}
                                                </div>
                                                <div className="flex gap-2 justify-end mt-2"><button onClick={handleSave} className="bg-green-500 text-white px-3 py-1 rounded text-sm font-bold flex items-center gap-1 hover:bg-green-600"><Icons.Save size={14}/> Salvar</button><button onClick={()=>setEditingId(null)} className="bg-gray-300 px-3 py-1 rounded text-sm font-bold hover:bg-gray-400">Cancelar</button></div>
                                            </div>
                                        ) : (
                                            <div className="flex justify-between w-full items-center">
                                                <div className={`flex items-center gap-3 ${p.hidden ? 'opacity-50 grayscale' : ''}`}>
                                                    <div className="w-10 h-10 bg-gray-200 rounded overflow-hidden">{p.image && <img src={p.image} className="w-full h-full object-cover"/>}</div>
                                                    <div><p className="font-bold text-sm flex items-center gap-2">{p.name} {p.hidden && <span className="bg-gray-600 text-white text-[10px] px-1 rounded">OCULTO</span>}</p><p className="text-xs text-gray-500">{p.category} ‚Ä¢ <span className="text-orange-600 font-bold">R$ {p.price.toFixed(2)}</span></p></div>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <button onClick={()=>toggleHidden(p)} title={p.hidden ? "Mostrar na loja" : "Ocultar da loja"} className={`p-2 rounded ${p.hidden ? 'text-gray-400 hover:text-gray-600' : 'text-green-600 hover:bg-green-50'}`}>{p.hidden ? <Icons.EyeOff size={16}/> : <Icons.Eye size={16}/>}</button>
                                                    <button onClick={()=>toggleAvail(p)} title={p.available ? "Marcar como Esgotado" : "Marcar como Dispon√≠vel"} className={`px-2 py-1 rounded text-xs font-bold ${p.available?'bg-green-100 text-green-700':'bg-red-100 text-red-700'}`}>{p.available?'Ativo':'Pausado'}</button>
                                                    <button onClick={()=>startEditing(p)} className="p-2 text-blue-600 hover:bg-blue-50 rounded"><Icons.Edit2 size={16}/></button>
                                                    <button onClick={()=>handleDelete(p.id)} className="p-2 text-red-600 hover:bg-red-50 rounded"><Icons.Trash2 size={16}/></button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('store'); 
            const [userRole, setUserRole] = useState(null);
            const [products, setProducts] = useState([]);
            const [cart, setCart] = useState({});
            const [isCartOpen, setIsCartOpen] = useState(false);
            const [isTrackerOpen, setIsTrackerOpen] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [activeSection, setActiveSection] = useState('Todos');
            const [categories, setCategories] = useState(DEFAULT_CATEGORIES);
            
            const isConfigured = firebaseConfig.apiKey !== "SUA_API_KEY_AQUI" && firebaseConfig.projectId !== "SEU_PROJETO_ID";

            useEffect(() => {
                if(!db || !isConfigured) return;
                const unsub = db.collection('products').onSnapshot(snap => {
                    const items = [];
                    let cats = DEFAULT_CATEGORIES;
                    snap.docs.forEach(doc => {
                        if (doc.id === 'config_categories') {
                            if (doc.data().list) cats = doc.data().list;
                        } else {
                            items.push({id: doc.id, ...doc.data()});
                        }
                    });
                    setProducts(items);
                    setCategories(cats);
                });
                return () => unsub();
            }, []);

            if (!isConfigured) { return <ConfigHelp />; }

            const updateCart = (p, qtd) => {
                setCart(prev => { const n = (prev[p.id] || 0) + qtd; if(n <= 0) { const c = {...prev}; delete c[p.id]; return c; } return {...prev, [p.id]: n}; });
            };

            const handleSaveCategories = async (newCats) => {
                await db.collection('products').doc('config_categories').set({ list: newCats });
            };

            const scrollToSection = (id) => {
                setActiveSection(id);
                if(id === 'Todos') {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    const element = document.getElementById(id);
                    if(element) {
                        const headerOffset = 180;
                        const elementPosition = element.getBoundingClientRect().top;
                        const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                        window.scrollTo({ top: offsetPosition, behavior: "smooth" });
                    }
                }
            };

            const totalItems = Object.values(cart).reduce((a,b)=>a+b,0);
            
            // Search filters globally
            const searchFiltered = products.filter(p => !p.hidden && p.name.toLowerCase().includes(searchTerm.toLowerCase()));

            const handleLogin = (pass) => {
                if(pass === 'admin') { setUserRole('owner'); setView('admin'); }
                else if(pass === '1234') { setUserRole('employee'); setView('admin'); }
                else alert('Senha incorreta!');
            };

            if(view === 'login') return (
                <div className="min-h-screen bg-gray-100 flex items-center justify-center p-4">
                    <div className="bg-white p-8 rounded-xl shadow-xl w-full max-w-sm text-center">
                        <Icons.Lock /> <h2 className="text-2xl font-bold my-4">Acesso Restrito</h2>
                        <input type="password" id="pass" placeholder="Senha (admin ou 1234)" className="w-full border p-3 rounded mb-4 text-center"/>
                        <button onClick={()=>handleLogin(document.getElementById('pass').value)} className="w-full bg-orange-600 text-white py-3 rounded font-bold">Entrar</button>
                        <button onClick={()=>setView('store')} className="mt-4 text-gray-400 text-sm">Voltar</button>
                    </div>
                </div>
            );

            if(view === 'admin') return <AdminPanel products={products} onLogout={()=>setView('store')} role={userRole} categories={categories} onSaveCategories={handleSaveCategories} />;

            return (
                <div className="pb-20">
                    <header className="bg-white sticky top-0 z-40 shadow-sm">
                        <div className="bg-gray-900 text-white text-xs py-2 px-4 flex flex-col md:flex-row justify-between items-center">
                            <div className="flex flex-col md:flex-row items-center gap-1 md:gap-4">
                                <span className="font-medium">üõµ Seg-S√°b 5:30-20h ‚Ä¢ Dom 5:30-12h</span>
                                <span className="hidden md:inline text-gray-500">|</span>
                                <span className="text-orange-200">üìç Rua Copacabana, 783 - Giovanini, Cel. Fabriciano</span>
                            </div>
                            <div className="flex gap-4 mt-2 md:mt-0 items-center">
                                <a href="https://www.instagram.com/padariagiovanini" target="_blank" className="flex gap-2 items-center bg-gradient-to-r from-purple-500 via-pink-500 to-orange-500 text-white px-4 py-1.5 rounded-full font-bold hover:scale-105 transition-transform shadow-lg border border-white/20">
                                    <Icons.Instagram size={14}/> Instagram
                                </a>
                                <button onClick={()=>setIsTrackerOpen(true)} className="flex gap-1 hover:text-orange-400 font-bold items-center"><Icons.Search size={12}/> Rastrear</button>
                                <button onClick={()=>setView('login')} className="flex gap-1 text-gray-400 hover:text-white items-center"><Icons.Lock size={12}/> Admin</button>
                            </div>
                        </div>
                        <div className="container mx-auto px-4 py-4 flex justify-between items-center">
                            <div className="flex items-center gap-4">
                                <img src="./logo.png" alt="Logo Padaria Giovaninni" className="w-20 h-20 md:w-24 md:h-24 rounded-full object-cover border-4 border-orange-100 shadow-sm" />
                                <div><h1 className="font-bold leading-none text-xl md:text-2xl text-gray-800">Padaria Giovaninni</h1><span className="text-sm text-green-600 font-bold flex items-center gap-1"><span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> Online</span></div>
                            </div>
                            <button onClick={()=>setIsCartOpen(true)} className="relative p-3 text-gray-600 hover:bg-gray-100 rounded-full"><Icons.ShoppingBag size={28} />{totalItems > 0 && <span className="absolute top-0 right-0 bg-red-500 text-white text-xs w-6 h-6 flex items-center justify-center rounded-full font-bold border-2 border-white">{totalItems}</span>}</button>
                        </div>
                        <div className="px-4 pb-4">
                            <input placeholder="Buscar..." className="w-full bg-gray-100 border-none rounded-xl py-3 px-4 mb-4 focus:ring-2 focus:ring-orange-500 outline-none" onChange={e=>setSearchTerm(e.target.value)}/>
                            <div className="flex gap-2 overflow-x-auto scrollbar-hide pb-2">
                                {['Todos', ...categories].map(c => <button key={c} onClick={()=>scrollToSection(c)} className={`px-5 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-colors ${activeSection===c?'bg-orange-600 text-white shadow-md':'bg-white border border-gray-200 text-gray-600 hover:bg-gray-50'}`}>{c}</button>)}
                            </div>
                        </div>
                    </header>

                    <main className="container mx-auto px-4 py-6">
                        {searchTerm ? (
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                {searchFiltered.length === 0 ? <p className="text-center col-span-3 text-gray-500">Nenhum produto encontrado na busca.</p> :
                                 searchFiltered.map(p => <ProductCard key={p.id} product={p} quantity={cart[p.id]||0} onAdd={updateCart} />)}
                            </div>
                        ) : (
                            <div className="space-y-12">
                                {(() => {
                                    // CRIA A LISTA DE PRESEN√áA (Conjunto de IDs j√° exibidos)
                                    const renderedProductIds = new Set();

                                    return (
                                        <>
                                            {categories.map(cat => {
                                                // M√ÅGICA: P√£es e P√£es Artesanais aparecem juntos na aba P√£es
                                                let catProducts;
                                                if (cat === 'P√£es') {
                                                    catProducts = products.filter(p => !p.hidden && (p.category === 'P√£es' || p.category === 'P√£es Artesanais'));
                                                } else {
                                                    catProducts = products.filter(p => !p.hidden && p.category === cat);
                                                }

                                                if (catProducts.length === 0) return null;

                                                // Marca os produtos como "J√° Exibidos"
                                                catProducts.forEach(p => renderedProductIds.add(p.id));

                                                return (
                                                    <div key={cat} id={cat} className="scroll-mt-48">
                                                        <h3 className="font-bold text-xl text-gray-800 mb-6 border-l-4 border-orange-500 pl-3 uppercase tracking-wide">{cat}</h3>
                                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                                            {catProducts.map(p => <ProductCard key={p.id} product={p} quantity={cart[p.id]||0} onAdd={updateCart} />)}
                                                        </div>
                                                    </div>
                                                )
                                            })}

                                            {/* SE√á√ÉO "OUTROS" CORRIGIDA: S√≥ mostra quem N√ÉO est√° na lista de presen√ßa */}
                                            {(() => {
                                                const otherProducts = products.filter(p => !p.hidden && !renderedProductIds.has(p.id));
                                                
                                                if (otherProducts.length === 0) return null;
                                                
                                                return (
                                                    <div key="Outros-Geral" id="Outros" className="scroll-mt-48">
                                                        <h3 className="font-bold text-xl text-gray-800 mb-6 border-l-4 border-gray-500 pl-3 uppercase tracking-wide">Outros / Diversos</h3>
                                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                                            {otherProducts.map(p => <ProductCard key={p.id} product={p} quantity={cart[p.id]||0} onAdd={updateCart} />)}
                                                        </div>
                                                    </div>
                                                );
                                            })()}
                                        </>
                                    );
                                })()}

                                {products.filter(p => !p.hidden).length === 0 && <p className="text-center text-gray-500 py-10">O card√°pio est√° sendo atualizado...</p>}
                            </div>
                        )}
                    </main>

                    <CartDrawer isOpen={isCartOpen} onClose={()=>setIsCartOpen(false)} cart={cart} products={products} onUpdateCart={updateCart} />
                    {isTrackerOpen && <OrderTracker onClose={()=>setIsTrackerOpen(false)} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
